<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Attendance Calculator with Login</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 { margin-bottom: 8px; }
    input, select { padding: 6px; margin: 6px; border: 1px solid #ccc; border-radius: 6px; }
    button { padding: 8px 14px; border: none; border-radius: 6px; background: #007bff; color: white; cursor: pointer; margin: 5px; }
    button:hover { background: #0056b3; }
    .card { background: white; padding: 16px; border-radius: 10px; margin: 20px auto; max-width: 900px; box-shadow: 0 4px 10px rgba(0,0,0,.1); }
    .calendar { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 6px; margin-top: 15px; }
    .day { padding: 12px; border-radius: 6px; background: #eee; cursor: pointer; }
    .present { background: #22c55e; color: white; }
    .absent { background: #ef4444; color: white; }
    .holiday { background: #9ca3af; color: white; }
    .hidden { display: none; }
    p.error { color: red; }

    /* üîê Center login/signup screens */
    #loginScreen, #signupScreen {
      display: none;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    #loginScreen.active, #signupScreen.active {
      display: flex;
    }
    #loginScreen .card, #signupScreen .card {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
      width: 320px;
      text-align: center;
    }
    #loginScreen .card input, #signupScreen .card input {
      width: 90%;
      padding: 10px;
      margin: 10px auto;
      border: 1px solid #ccc;
      border-radius: 6px;
      display: block;
    }
    #loginScreen .card button, #signupScreen .card button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 6px;
      background: #007bff;
      color: white;
      cursor: pointer;
      font-size: 16px;
    }
    #loginScreen .card button:hover, #signupScreen .card button:hover { background: #0056b3; }
  </style>
</head>
<body>

  <!-- üîê LOGIN SCREEN -->
  <div id="loginScreen">
    <div class="card">
      <h2>üîê Login</h2>
      <input type="text" id="loginUser" placeholder="Username (email)">
      <input type="password" id="loginPass" placeholder="Password">
      <button onclick="login()">Sign In</button>
      <p id="loginError" class="error"></p>
      <p>Don't have an account? <a href="#" onclick="showSignup()">Sign Up</a></p>
    </div>
  </div>

  <!-- üìù SIGNUP SCREEN -->
  <div id="signupScreen">
    <div class="card">
      <h2>üìù Sign Up</h2>
      <input type="text" id="signupUser" placeholder="Username (email)">
      <input type="password" id="signupPass" placeholder="Password">
      <button onclick="signup()">Register</button>
      <p id="signupError" class="error"></p>
      <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
    </div>
  </div>

  <!-- üìä ATTENDANCE CALCULATOR -->
  <div id="calculatorScreen" class="hidden">
    <h1>üìä Attendance Calculator (L/T/P/S)</h1>
    <p>Track attendance separately for Lectures, Tutorials, Practicals, and Seminars.</p>
    <button onclick="logout()">üö™ Logout</button>
    <a href="wc.html">
      <button id="toggleWeatherBtn" onclick="toggleWeather()">üå¶ Show Weather & Calendar</button>
    </a>
    <a href="calc.html" >
      <button class="link button">üßÆ QuantumCalc</button>
    </a>
    <!-- Controls -->
    <div class="card">
      <label>Subject:
        <select id="subject">
          <option value="Lecture">Lecture (L)</option>
          <option value="Tutorial">Tutorial (T)</option>
          <option value="Practical">Practical (P)</option>
          <option value="Seminar">Seminar (S)</option>
        </select>
      </label>
      <br>
      <label>Requirement %:
        <select id="req">
          <option value="75">75%</option>
          <option value="65">65%</option>
          <option value="80">80%</option>
        </select>
      </label>
      <br>
      <label>Present Classes: <input type="number" id="present"></label>
      <label>Total Classes: <input type="number" id="total"></label>
      <br>
      <button onclick="generateAttendance()">Generate</button>
      <p id="summary"></p>
    </div>

    <!-- Tools -->
    <div class="card">
      <button onclick="saveAttendance()">üíæ Save</button>
      <button onclick="loadAttendance()">üìÇ Load</button>
      <button onclick="exportCSV()">‚¨áÔ∏è Export CSV</button>
      <button onclick="predictNext()">üîÆ Next Class Predictor</button>
      <p id="prediction"></p>
    </div>

    <!-- Calendar -->
    <div class="card">
      <h3>üóì Attendance Calendar</h3>
      <div id="calendar" class="calendar"></div>
    </div>

    <!-- Charts -->
    <div class="card">
      <h3>üìä Charts (per subject)</h3>
      <canvas id="pieChart"></canvas>
      <canvas id="weekChart"></canvas>
    </div>
  </div>

<script>
/* ------------------ LOGIN SYSTEM ------------------ */
function showSignup() {
  document.getElementById("loginScreen").classList.remove("active");
  document.getElementById("signupScreen").classList.add("active");
}
function showLogin() {
  document.getElementById("signupScreen").classList.remove("active");
  document.getElementById("loginScreen").classList.add("active");
}

function signup() {
  const user = document.getElementById("signupUser").value;
  const pass = document.getElementById("signupPass").value;
  if (!user || !pass) {
    document.getElementById("signupError").textContent = "‚ö†Ô∏è Please fill all fields";
    return;
  }
  let users = JSON.parse(localStorage.getItem("users")) || {};
  if (users[user]) {
    document.getElementById("signupError").textContent = "‚ö†Ô∏è User already exists!";
    return;
  }
  users[user] = pass;
  localStorage.setItem("users", JSON.stringify(users));
  alert("‚úÖ Account created. Please login.");
  showLogin();
}

function login() {
  const user = document.getElementById("loginUser").value;
  const pass = document.getElementById("loginPass").value;
  let users = JSON.parse(localStorage.getItem("users")) || {};
  if (users[user] && users[user] === pass) {
    localStorage.setItem("loggedInUser", user);
    document.getElementById("loginScreen").classList.remove("active");
    document.getElementById("signupScreen").classList.remove("active");
    document.getElementById("calculatorScreen").classList.remove("hidden");
  } else {
    document.getElementById("loginError").textContent = "‚ùå Invalid username or password!";
  }
}

function logout() {
  localStorage.removeItem("loggedInUser");
  document.getElementById("calculatorScreen").classList.add("hidden");
  document.getElementById("loginScreen").classList.add("active");
}

window.onload = function() {
  if (localStorage.getItem("loggedInUser")) {
    document.getElementById("calculatorScreen").classList.remove("hidden");
  } else {
    document.getElementById("loginScreen").classList.add("active");
  }
}

/* ------------------ ATTENDANCE CALCULATOR ------------------ */
let dataStore = { Lecture:{}, Tutorial:{}, Practical:{}, Seminar:{} };
let total = { Lecture:0, Tutorial:0, Practical:0, Seminar:0 };
let present = { Lecture:0, Tutorial:0, Practical:0, Seminar:0 };
let required = 75;

function currentSubject() { return document.getElementById("subject").value; }

function generateAttendance() {
  const subj = currentSubject();
  present[subj] = Number(document.getElementById("present").value);
  total[subj] = Number(document.getElementById("total").value);
  required = Number(document.getElementById("req").value);

  if (total[subj] <= 0 || present[subj] < 0 || present[subj] > total[subj]) {
    alert("Enter valid numbers");
    return;
  }
  dataStore[subj] = {};
  for (let i = 1; i <= total[subj]; i++) {
    dataStore[subj][i] = (i <= present[subj]) ? "present" : "absent";
  }
  updateSummary(); renderCalendar(); drawCharts();
}

function updateSummary() {
  const subj = currentSubject();
  const attended = Object.values(dataStore[subj]).filter(v => v === "present").length;
  const totalClasses = Object.values(dataStore[subj]).filter(v => v !== "holiday").length;
  const percent = totalClasses ? (attended / totalClasses) * 100 : 0;
  const need = Math.max(0, Math.ceil((required/100)*totalClasses) - attended);
  const summary = document.getElementById("summary");
  summary.innerHTML =
    `(${subj}) Present: <b>${attended}</b> / ${totalClasses} (${percent.toFixed(2)}%) <br>` +
    (percent >= required ? `‚úÖ Requirement met (${required}%)` :
    `‚ö†Ô∏è Need ${need} more classes to reach ${required}%`);
  summary.style.color = percent >= required ? "green" : "red";
}

function renderCalendar() {
  const subj = currentSubject();
  const cal = document.getElementById("calendar");
  cal.innerHTML = "";
  for (let i = 1; i <= total[subj]; i++) {
    const cell = document.createElement("div");
    cell.className = "day " + dataStore[subj][i];
    cell.textContent = "Day " + i;
    cell.onclick = () => {
      dataStore[subj][i] = dataStore[subj][i] === "holiday" ? "present" :
                          dataStore[subj][i] === "present" ? "absent" : "holiday";
      renderCalendar(); updateSummary(); drawCharts();
    };
    cal.appendChild(cell);
  }
}

function saveAttendance() {
  localStorage.setItem("attendanceData", JSON.stringify({dataStore,total,present,required}));
  alert("Attendance saved ‚úÖ");
}
function loadAttendance() {
  const data = JSON.parse(localStorage.getItem("attendanceData"));
  if (data) {
    dataStore = data.dataStore; total = data.total; present = data.present; required = data.required;
    renderCalendar(); updateSummary(); drawCharts();
  } else { alert("No saved data ‚ùå"); }
}
function exportCSV() {
  let csv = "Subject,Day,Status\n";
  for (const subj in dataStore) {
    for (let i=1; i<=total[subj]; i++) {
      csv += `${subj},Day ${i},${dataStore[subj][i]}\n`;
    }
  }
  const blob = new Blob([csv], { type: "text/csv" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "attendance.csv"; link.click();
}
function predictNext() {
  const subj = currentSubject();
  const attended = Object.values(dataStore[subj]).filter(v => v==="present").length;
  const totalClasses = Object.values(dataStore[subj]).filter(v => v!=="holiday").length;

  const attendNext = ((attended+1)/(totalClasses+1))*100;
  const skipNext = (attended/(totalClasses+1))*100;

  document.getElementById("prediction").innerHTML =
    `(${subj})<br>` +
    `If you attend next: <b>${attendNext.toFixed(2)}%</b> ` +
    (attendNext >= required ? "‚úÖ Requirement met" : "‚ö†Ô∏è Below requirement") + "<br>" +
    `If you skip next: <b>${skipNext.toFixed(2)}%</b> ` +
    (skipNext >= required ? "‚úÖ Requirement met" : "‚ö†Ô∏è Below requirement");
}

let pieChart, weekChart;
function drawCharts() {
  const subj = currentSubject();
  const ctx1 = document.getElementById("pieChart").getContext("2d");
  if (pieChart) pieChart.destroy();
  const p = Object.values(dataStore[subj]).filter(v => v==="present").length;
  const a = Object.values(dataStore[subj]).filter(v => v==="absent").length;
  const h = Object.values(dataStore[subj]).filter(v => v==="holiday").length;
  pieChart = new Chart(ctx1, {
    type: "pie",
    data: { labels: ["Present","Absent","Holiday"],
      datasets: [{ data:[p,a,h], backgroundColor:["#22c55e","#ef4444","#9ca3af"] }] }
  });

  const ctx2 = document.getElementById("weekChart").getContext("2d");
  if (weekChart) weekChart.destroy();
  const weeks = Math.ceil(total[subj]/7);
  let weekData = [];
  for (let w=0; w<weeks; w++) {
    let start = w*7+1, end = Math.min(total[subj],(w+1)*7);
    let weekDays = 0, weekPres = 0;
    for (let d=start; d<=end; d++) {
      if (dataStore[subj][d] !== "holiday") { weekDays++; if (dataStore[subj][d]==="present") weekPres++; }
    }
    weekData.push(weekDays? (weekPres/weekDays*100) : 0);
  }
  weekChart = new Chart(ctx2, {
    type: "line",
    data: { labels: weekData.map((_,i)=>"Week "+(i+1)),
      datasets: [{ label:`${subj} Weekly %`, data:weekData,
        borderColor:"#007bff", backgroundColor:"rgba(0,123,255,0.2)",
        fill:true, tension:0.4 }] }
  });
}
</script>
</body>
</html>
